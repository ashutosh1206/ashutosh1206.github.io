<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>RSA-Padding - N1CTF | Ashutosh Ahelleya</title><meta name=keywords content="RSA,NumberTheory,FranklinReiter"><meta name=description content="Challenge Points: 303
Challenge is running on the service: nc 47.75.39.249 23333
After surpassing the Proof of Work, we get the following challenge: On selecting the option get code, we get the following code that is being used for encryption:
#!/usr/bin/env python3 # -*- coding=utf-8 -*- from Crypto.Util.number import getPrime, GCD, bytes_to_long from hashlib import sha256 import random import signal import sys, os signal.alarm(20) m = b&#34;xxxxxxxxxxxxxx&#34; n = 21727106551797231400330796721401157037131178503238742210927927256416073956351568958100038047053002307191569558524956627892618119799679572039939819410371609015002302388267502253326720505214690802942662248282638776986759094777991439524946955458393011802700815763494042802326575866088840712980094975335414387283865492939790773300256234946983831571957038601270911425008907130353723909371646714722730577923843205527739734035515152341673364211058969041089741946974118237091455770042750971424415176552479618605177552145594339271192853653120859740022742221562438237923294609436512995857399568803043924319953346241964071252941 e = 3 def proof(): strings = &#34;abcdefghijklmnopqrstuvwxyzWOERFJASKL&#34; prefix = &#34;&#34;."><meta name=author content="Ashutosh Ahelleya"><link rel=canonical href=https://ashutosh1206.github.io/ctf/n1ctf18-rsa-padding/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ashutosh1206.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ashutosh1206.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ashutosh1206.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ashutosh1206.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ashutosh1206.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css integrity=sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0 crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js integrity=sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><meta property="og:title" content="RSA-Padding - N1CTF"><meta property="og:description" content="Challenge Points: 303
Challenge is running on the service: nc 47.75.39.249 23333
After surpassing the Proof of Work, we get the following challenge: On selecting the option get code, we get the following code that is being used for encryption:
#!/usr/bin/env python3 # -*- coding=utf-8 -*- from Crypto.Util.number import getPrime, GCD, bytes_to_long from hashlib import sha256 import random import signal import sys, os signal.alarm(20) m = b&#34;xxxxxxxxxxxxxx&#34; n = 21727106551797231400330796721401157037131178503238742210927927256416073956351568958100038047053002307191569558524956627892618119799679572039939819410371609015002302388267502253326720505214690802942662248282638776986759094777991439524946955458393011802700815763494042802326575866088840712980094975335414387283865492939790773300256234946983831571957038601270911425008907130353723909371646714722730577923843205527739734035515152341673364211058969041089741946974118237091455770042750971424415176552479618605177552145594339271192853653120859740022742221562438237923294609436512995857399568803043924319953346241964071252941 e = 3 def proof(): strings = &#34;abcdefghijklmnopqrstuvwxyzWOERFJASKL&#34; prefix = &#34;&#34;."><meta property="og:type" content="article"><meta property="og:url" content="https://ashutosh1206.github.io/ctf/n1ctf18-rsa-padding/"><meta property="article:section" content="ctf"><meta property="article:published_time" content="2018-03-12T00:00:00+00:00"><meta property="article:modified_time" content="2018-03-12T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="RSA-Padding - N1CTF"><meta name=twitter:description content="Challenge Points: 303
Challenge is running on the service: nc 47.75.39.249 23333
After surpassing the Proof of Work, we get the following challenge: On selecting the option get code, we get the following code that is being used for encryption:
#!/usr/bin/env python3 # -*- coding=utf-8 -*- from Crypto.Util.number import getPrime, GCD, bytes_to_long from hashlib import sha256 import random import signal import sys, os signal.alarm(20) m = b&#34;xxxxxxxxxxxxxx&#34; n = 21727106551797231400330796721401157037131178503238742210927927256416073956351568958100038047053002307191569558524956627892618119799679572039939819410371609015002302388267502253326720505214690802942662248282638776986759094777991439524946955458393011802700815763494042802326575866088840712980094975335414387283865492939790773300256234946983831571957038601270911425008907130353723909371646714722730577923843205527739734035515152341673364211058969041089741946974118237091455770042750971424415176552479618605177552145594339271192853653120859740022742221562438237923294609436512995857399568803043924319953346241964071252941 e = 3 def proof(): strings = &#34;abcdefghijklmnopqrstuvwxyzWOERFJASKL&#34; prefix = &#34;&#34;."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Ctfs","item":"https://ashutosh1206.github.io/ctf/"},{"@type":"ListItem","position":2,"name":"RSA-Padding - N1CTF","item":"https://ashutosh1206.github.io/ctf/n1ctf18-rsa-padding/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"RSA-Padding - N1CTF","name":"RSA-Padding - N1CTF","description":"Challenge Points: 303\nChallenge is running on the service: nc 47.75.39.249 23333\nAfter surpassing the Proof of Work, we get the following challenge: On selecting the option get code, we get the following code that is being used for encryption:\n#!/usr/bin/env python3 # -*- coding=utf-8 -*- from Crypto.Util.number import getPrime, GCD, bytes_to_long from hashlib import sha256 import random import signal import sys, os signal.alarm(20) m = b\u0026#34;xxxxxxxxxxxxxx\u0026#34; n = 21727106551797231400330796721401157037131178503238742210927927256416073956351568958100038047053002307191569558524956627892618119799679572039939819410371609015002302388267502253326720505214690802942662248282638776986759094777991439524946955458393011802700815763494042802326575866088840712980094975335414387283865492939790773300256234946983831571957038601270911425008907130353723909371646714722730577923843205527739734035515152341673364211058969041089741946974118237091455770042750971424415176552479618605177552145594339271192853653120859740022742221562438237923294609436512995857399568803043924319953346241964071252941 e = 3 def proof(): strings = \u0026#34;abcdefghijklmnopqrstuvwxyzWOERFJASKL\u0026#34; prefix = \u0026#34;\u0026#34;.","keywords":["RSA","NumberTheory","FranklinReiter"],"articleBody":"Challenge Points: 303\nChallenge is running on the service: nc 47.75.39.249 23333\nAfter surpassing the Proof of Work, we get the following challenge: On selecting the option get code, we get the following code that is being used for encryption:\n#!/usr/bin/env python3 # -*- coding=utf-8 -*- from Crypto.Util.number import getPrime, GCD, bytes_to_long from hashlib import sha256 import random import signal import sys, os signal.alarm(20) m = b\"xxxxxxxxxxxxxx\" n = 21727106551797231400330796721401157037131178503238742210927927256416073956351568958100038047053002307191569558524956627892618119799679572039939819410371609015002302388267502253326720505214690802942662248282638776986759094777991439524946955458393011802700815763494042802326575866088840712980094975335414387283865492939790773300256234946983831571957038601270911425008907130353723909371646714722730577923843205527739734035515152341673364211058969041089741946974118237091455770042750971424415176552479618605177552145594339271192853653120859740022742221562438237923294609436512995857399568803043924319953346241964071252941 e = 3 def proof(): strings = \"abcdefghijklmnopqrstuvwxyzWOERFJASKL\" prefix = \"\".join(random.sample(strings, 6)) starwith = str(random.randint(10000, 99999)) pf = \"\"\" sha256(\"%s\"+str).hexdigest().startswith(\"%s\") == True Please give me str \"\"\"%(prefix, starwith) print(pf) s = input().strip() if sha256((prefix+s).encode()).hexdigest().startswith(starwith): return True else: return False def cmd(): help = \"\"\" 1. get code 2. get flag Please tell me, what you want? \"\"\" while True: print(help) c = input().strip() if c == \"1\": return True elif c == \"2\": return False else: print(\"Enter Error!\") def main(): if not proof(): print(\"Check Failed!\") return welcom() if cmd(): f = open(\"file.py\") print(f.read()) return mm = bytes_to_long(m) assert pow(mm, e) != pow(mm, e, n) sys.stdout.write(\"Please give me a padding: \") padding = input().strip() padding = int(sha256(padding.encode()).hexdigest(),16) c = pow(mm+padding, e, n) print(\"Your Ciphertext is: %s\"%c) if __name__ == '__main__': main() Upon selecting the get flag option, the following computation is done:\n$$c \\equiv (flag + sha256(input))^3\\mod n$$ where input is an input string that we give to the server, sha256() is a function that generates integer representation of SHA-256 hash of the input and c is the corresponding ciphertext.\nServer then returns c as the output. One important thing to note here is that \\(m^3 \u003e n\\), hence we cannot directly calculate cube root of the ciphertext.\nPublic key values:\nn = 21727106551797231400330796721401157037131178503238742210927927256416073956351568958100038047053002307191569558524956627892618119799679572039939819410371609015002302388267502253326720505214690802942662248282638776986759094777991439524946955458393011802700815763494042802326575866088840712980094975335414387283865492939790773300256234946983831571957038601270911425008907130353723909371646714722730577923843205527739734035515152341673364211058969041089741946974118237091455770042750971424415176552479618605177552145594339271192853653120859740022742221562438237923294609436512995857399568803043924319953346241964071252941 e = 3 Vulnerability Allowing user controlled padding exposes the challenge to Franklin-Reiter’s related message attack.\nI found an easier way to solve this challenge using very basic Algebra and Number Theory concepts, as compared to the attack described in the above hyperlink.\nFirst, we send 2 as an input to the server and get corresponding ciphertext:\nc1 = 14550589053226237723784378782911157204367764723816957959635387925652898370034365455451983914571405062459535687617841302966938233065296973978472553109061974458935966754832788411876301179210585984208608247433383774246743661884093657109502619626436726032508763685599880808525861655167503719155953736308920858354069083437923495143680174206534169208623366776314544036377265501358254923029291010047210371394197963442022610746743020719292018028518885149189744832788117626194748311114409968846879212425054195323473068436359069318372735069308398135560733890706617536127579272964863500568572120716434126233695562326533941909353 Next, we send 1 as an input to the server and get corresponding ciphertext:\nc2 = 14550589053226237723784378782911157204367764723813789158271625147472004207734354619642445255036997940341703539883653916130592718879734436263217819317202435434496341973502556894834798718992952369685841347018901038478081710519253844078907000973324354805502890255414196801758171762906898874914776720897920729518384393581853690034053515213192846817920534901501370942556249012415259244063185938984570137371682805276444650716010228924732495062415330875872004691866847132147232457398743319930259327973290858489741376000333603734294893832124907092640953321640151851853501528390729805151850605432707293088635480863375398001441 For c1 and c2 we can write the following:\nh1 = int(sha256('2').hexdigest(), 16) h2 = int(sha256('1').hexdigest(), 16) \\(c_1\\equiv (m+h_1)^3\\mod n\\) –\u003e (1)\n\\(c_2\\equiv (m+h_2)^3\\mod n\\) –\u003e (2)\nwhere m is the flag that we want to calculate!\nOn expanding (1) we get:\n\\(\\implies c_1 \\equiv m^3 + h_1^3 + 3m^2h_1 + 3mh_1^2\\mod n\\) –\u003e (3)\nSimilarly, on expanding (2) we get:\n\\(\\implies c_2 \\equiv m^3 + h_2^3 + 3m^2h_2 + 3mh_2^2\\mod n\\) –\u003e (4)\nSubtracting (4) from (3), we get:\n$$c_1 - c_2 \\equiv (h_1-h_2)(h_1^2 + h_1h_2 + h_2^2) + 3m^2(h_1 - h_2) + 3m(h_1 + h_2)(h_1 - h_2)\\mod n$$ $$\\frac{c_1 - c_2}{h_1 - h_2}\\equiv (h_1^2 + h_1h_2 + h_2^2) + 3m^2 + 3m(h_1 + h_2) \\mod n$$\nIf we substitute \\(x = \\frac{c_1 - c_2}{h_1 - h_2}\\), we get: $$3m^2 + 3m(h_1 + h_2) + (h_1^2 + h_1h_2 + h_2^2 - x)\\equiv 0\\mod n$$ The above equation is quadratic, we also know the values of \\(h_1\\) \u0026 \\(h_2\\).\nAccording to the quadratic formula, we have: $$m \\equiv \\frac{-b;\\pm;\\sqrt{b^2-4ac}}{2a}\\mod n$$ Hence, we can calculate m as: $$m \\equiv \\frac{-3(h_1+h_2);\\pm;\\sqrt{(3(h_1+h_2))^2-12(h_1^2 + h_1h_2 + h_2^2 - x)}}{6}\\mod n$$\nWrote the following script to implement the attack:\nimport hashlib import gmpy2 from Crypto.Util.number import * hash1 = int(hashlib.sha256('2').hexdigest(), 16) hash2 = int(hashlib.sha256('1').hexdigest(), 16) diff = hash1 - hash2 print \"diff: \", diff # M1 = M2 + diff n = 21727106551797231400330796721401157037131178503238742210927927256416073956351568958100038047053002307191569558524956627892618119799679572039939819410371609015002302388267502253326720505214690802942662248282638776986759094777991439524946955458393011802700815763494042802326575866088840712980094975335414387283865492939790773300256234946983831571957038601270911425008907130353723909371646714722730577923843205527739734035515152341673364211058969041089741946974118237091455770042750971424415176552479618605177552145594339271192853653120859740022742221562438237923294609436512995857399568803043924319953346241964071252941L e = 3 c1 = 14550589053226237723784378782911157204367764723816957959635387925652898370034365455451983914571405062459535687617841302966938233065296973978472553109061974458935966754832788411876301179210585984208608247433383774246743661884093657109502619626436726032508763685599880808525861655167503719155953736308920858354069083437923495143680174206534169208623366776314544036377265501358254923029291010047210371394197963442022610746743020719292018028518885149189744832788117626194748311114409968846879212425054195323473068436359069318372735069308398135560733890706617536127579272964863500568572120716434126233695562326533941909353 c2 = 14550589053226237723784378782911157204367764723813789158271625147472004207734354619642445255036997940341703539883653916130592718879734436263217819317202435434496341973502556894834798718992952369685841347018901038478081710519253844078907000973324354805502890255414196801758171762906898874914776720897920729518384393581853690034053515213192846817920534901501370942556249012415259244063185938984570137371682805276444650716010228924732495062415330875872004691866847132147232457398743319930259327973290858489741376000333603734294893832124907092640953321640151851853501528390729805151850605432707293088635480863375398001441 assert c2 \u003c n assert c1 \u003c n assert c1 \u003e c2 res = (c1 - c2) / (hash1 - hash2) a = 3 b = 3*(hash1 + hash2) c = (hash1**2 + hash1*hash2 + hash2**2) - res assert b**2 - 4*a*c \u003e= 0 det = gmpy2.iroot(b**2 - 4*a*c, 2) #Result of the above operation det = 895117860555194221639962847152553327251877885494596369020458400464169641215830527612022789636620223733091925404109820014339798528983673228478908782900199621057014409705139235003835944181120537080102658020544028036693589036615231884111568905196654L sol1 = (det - b)/(2*a) print long_to_bytes(sol1) Flag: N1CTF{f7efbf4e5f5ef78ca1fb9c8f5eb02635}\n","wordCount":"664","inLanguage":"en","datePublished":"2018-03-12T00:00:00Z","dateModified":"2018-03-12T00:00:00Z","author":{"@type":"Person","name":"Ashutosh Ahelleya"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ashutosh1206.github.io/ctf/n1ctf18-rsa-padding/"},"publisher":{"@type":"Organization","name":"Ashutosh Ahelleya","logo":{"@type":"ImageObject","url":"https://ashutosh1206.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ashutosh1206.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ashutosh1206.github.io/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://ashutosh1206.github.io/archive/ title=Archive><span>Archive</span></a></li><li><a href=https://ashutosh1206.github.io/ctf/ title=CTF><span>CTF</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>RSA-Padding - N1CTF</h1><div class=post-meta><span title='2018-03-12 00:00:00 +0000 UTC'>March 12, 2018</span>&nbsp;·&nbsp;Ashutosh Ahelleya</div></header><div class=post-content><p><strong>Challenge Points</strong>: 303</p><p>Challenge is running on the service: <code>nc 47.75.39.249 23333</code><br>After surpassing the Proof of Work, we get the following challenge:
<img loading=lazy src=/n1ctf18-rsapadding1.png alt=picture></p><p>On selecting the option <strong><code>get code</code></strong>, we get the following code that is being used for encryption:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding=utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> getPrime, GCD, bytes_to_long
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> hashlib <span style=color:#f92672>import</span> sha256
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> random
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> signal
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys<span style=color:#f92672>,</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>signal<span style=color:#f92672>.</span>alarm(<span style=color:#ae81ff>20</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;xxxxxxxxxxxxxx&#34;</span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>21727106551797231400330796721401157037131178503238742210927927256416073956351568958100038047053002307191569558524956627892618119799679572039939819410371609015002302388267502253326720505214690802942662248282638776986759094777991439524946955458393011802700815763494042802326575866088840712980094975335414387283865492939790773300256234946983831571957038601270911425008907130353723909371646714722730577923843205527739734035515152341673364211058969041089741946974118237091455770042750971424415176552479618605177552145594339271192853653120859740022742221562438237923294609436512995857399568803043924319953346241964071252941</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>proof</span>():
</span></span><span style=display:flex><span>    strings <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;abcdefghijklmnopqrstuvwxyzWOERFJASKL&#34;</span>
</span></span><span style=display:flex><span>    prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join(random<span style=color:#f92672>.</span>sample(strings, <span style=color:#ae81ff>6</span>))
</span></span><span style=display:flex><span>    starwith <span style=color:#f92672>=</span> str(random<span style=color:#f92672>.</span>randint(<span style=color:#ae81ff>10000</span>, <span style=color:#ae81ff>99999</span>))
</span></span><span style=display:flex><span>    pf <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>sha256(&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;+str).hexdigest().startswith(&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;) == True
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Please give me str
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span><span style=color:#f92672>%</span>(prefix, starwith)
</span></span><span style=display:flex><span>    print(pf)
</span></span><span style=display:flex><span>    s <span style=color:#f92672>=</span> input()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> sha256((prefix<span style=color:#f92672>+</span>s)<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest()<span style=color:#f92672>.</span>startswith(starwith):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cmd</span>():
</span></span><span style=display:flex><span>    help <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>1. get code
</span></span></span><span style=display:flex><span><span style=color:#e6db74>2. get flag
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Please tell me, what you want?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        print(help)
</span></span><span style=display:flex><span>        c <span style=color:#f92672>=</span> input()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> c <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;1&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> c <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;2&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Enter Error!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> proof():
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Check Failed!&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    welcom()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> cmd():
</span></span><span style=display:flex><span>        f <span style=color:#f92672>=</span> open(<span style=color:#e6db74>&#34;file.py&#34;</span>)
</span></span><span style=display:flex><span>        print(f<span style=color:#f92672>.</span>read())
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    mm <span style=color:#f92672>=</span> bytes_to_long(m)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> pow(mm, e) <span style=color:#f92672>!=</span> pow(mm, e, n)
</span></span><span style=display:flex><span>    sys<span style=color:#f92672>.</span>stdout<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;Please give me a padding: &#34;</span>)
</span></span><span style=display:flex><span>    padding <span style=color:#f92672>=</span> input()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>    padding <span style=color:#f92672>=</span> int(sha256(padding<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest(),<span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>    c <span style=color:#f92672>=</span> pow(mm<span style=color:#f92672>+</span>padding, e, n)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Your Ciphertext is: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>%</span>c)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><p>Upon selecting the <strong><code>get flag</code></strong> option, the following computation is done:<br>$$c \equiv (flag + sha256(input))^3\mod n$$
where <code>input</code> is an input string that we give to the server, sha256() is a function that generates integer representation of SHA-256 hash of the <code>input</code> and <code>c</code> is the corresponding ciphertext.</p><p>Server then returns <code>c</code> as the output. One important thing to note here is that \(m^3 > n\), hence we cannot directly calculate cube root of the ciphertext.</p><p>Public key values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>21727106551797231400330796721401157037131178503238742210927927256416073956351568958100038047053002307191569558524956627892618119799679572039939819410371609015002302388267502253326720505214690802942662248282638776986759094777991439524946955458393011802700815763494042802326575866088840712980094975335414387283865492939790773300256234946983831571957038601270911425008907130353723909371646714722730577923843205527739734035515152341673364211058969041089741946974118237091455770042750971424415176552479618605177552145594339271192853653120859740022742221562438237923294609436512995857399568803043924319953346241964071252941</span>
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><h2 id=vulnerability>Vulnerability<a hidden class=anchor aria-hidden=true href=#vulnerability>#</a></h2><p>Allowing user controlled padding exposes the challenge to <a href=https://github.com/ashutosh1206/Crypton/blob/master/RSA-encryption/Attack-Franklin-Reiter/README.md>Franklin-Reiter&rsquo;s related message attack</a>.</p><p>I found an easier way to solve this challenge using very basic Algebra and Number Theory concepts, as compared to the attack described in the above hyperlink.</p><p>First, we send <code>2</code> as an input to the server and get corresponding ciphertext:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>14550589053226237723784378782911157204367764723816957959635387925652898370034365455451983914571405062459535687617841302966938233065296973978472553109061974458935966754832788411876301179210585984208608247433383774246743661884093657109502619626436726032508763685599880808525861655167503719155953736308920858354069083437923495143680174206534169208623366776314544036377265501358254923029291010047210371394197963442022610746743020719292018028518885149189744832788117626194748311114409968846879212425054195323473068436359069318372735069308398135560733890706617536127579272964863500568572120716434126233695562326533941909353</span>
</span></span></code></pre></div><p>Next, we send <code>1</code> as an input to the server and get corresponding ciphertext:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>c2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>14550589053226237723784378782911157204367764723813789158271625147472004207734354619642445255036997940341703539883653916130592718879734436263217819317202435434496341973502556894834798718992952369685841347018901038478081710519253844078907000973324354805502890255414196801758171762906898874914776720897920729518384393581853690034053515213192846817920534901501370942556249012415259244063185938984570137371682805276444650716010228924732495062415330875872004691866847132147232457398743319930259327973290858489741376000333603734294893832124907092640953321640151851853501528390729805151850605432707293088635480863375398001441</span>
</span></span></code></pre></div><p>For <code>c1</code> and <code>c2</code> we can write the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>h1 <span style=color:#f92672>=</span> int(sha256(<span style=color:#e6db74>&#39;2&#39;</span>)<span style=color:#f92672>.</span>hexdigest(), <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>h2 <span style=color:#f92672>=</span> int(sha256(<span style=color:#e6db74>&#39;1&#39;</span>)<span style=color:#f92672>.</span>hexdigest(), <span style=color:#ae81ff>16</span>)
</span></span></code></pre></div><p>\(c_1\equiv (m+h_1)^3\mod n\) &ndash;> <strong>(1)</strong><br>\(c_2\equiv (m+h_2)^3\mod n\) &ndash;> <strong>(2)</strong></p><p>where <code>m</code> is the flag that we want to calculate!</p><p>On expanding (1) we get:<br>\(\implies c_1 \equiv m^3 + h_1^3 + 3m^2h_1 + 3mh_1^2\mod n\) &ndash;> <strong>(3)</strong><br>Similarly, on expanding (2) we get:<br>\(\implies c_2 \equiv m^3 + h_2^3 + 3m^2h_2 + 3mh_2^2\mod n\) &ndash;> <strong>(4)</strong></p><p>Subtracting (4) from (3), we get:<br>$$c_1 - c_2 \equiv (h_1-h_2)(h_1^2 + h_1h_2 + h_2^2) + 3m^2(h_1 - h_2) + 3m(h_1 + h_2)(h_1 - h_2)\mod n$$
$$\frac{c_1 - c_2}{h_1 - h_2}\equiv (h_1^2 + h_1h_2 + h_2^2) + 3m^2 + 3m(h_1 + h_2) \mod n$$</p><p>If we substitute \(x = \frac{c_1 - c_2}{h_1 - h_2}\), we get:
$$3m^2 + 3m(h_1 + h_2) + (h_1^2 + h_1h_2 + h_2^2 - x)\equiv 0\mod n$$
The above equation is quadratic, we also know the values of \(h_1\) & \(h_2\).</p><p>According to the quadratic formula, we have:
$$m \equiv \frac{-b;\pm;\sqrt{b^2-4ac}}{2a}\mod n$$
Hence, we can calculate <code>m</code> as:
$$m \equiv \frac{-3(h_1+h_2);\pm;\sqrt{(3(h_1+h_2))^2-12(h_1^2 + h_1h_2 + h_2^2 - x)}}{6}\mod n$$</p><p>Wrote the following script to implement the attack:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> gmpy2
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hash1 <span style=color:#f92672>=</span> int(hashlib<span style=color:#f92672>.</span>sha256(<span style=color:#e6db74>&#39;2&#39;</span>)<span style=color:#f92672>.</span>hexdigest(), <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>hash2 <span style=color:#f92672>=</span> int(hashlib<span style=color:#f92672>.</span>sha256(<span style=color:#e6db74>&#39;1&#39;</span>)<span style=color:#f92672>.</span>hexdigest(), <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>diff <span style=color:#f92672>=</span> hash1 <span style=color:#f92672>-</span> hash2
</span></span><span style=display:flex><span>print <span style=color:#e6db74>&#34;diff: &#34;</span>, diff
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># M1 = M2 + diff</span>
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> <span style=color:#ae81ff>21727106551797231400330796721401157037131178503238742210927927256416073956351568958100038047053002307191569558524956627892618119799679572039939819410371609015002302388267502253326720505214690802942662248282638776986759094777991439524946955458393011802700815763494042802326575866088840712980094975335414387283865492939790773300256234946983831571957038601270911425008907130353723909371646714722730577923843205527739734035515152341673364211058969041089741946974118237091455770042750971424415176552479618605177552145594339271192853653120859740022742221562438237923294609436512995857399568803043924319953346241964071252941</span>L
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>c1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>14550589053226237723784378782911157204367764723816957959635387925652898370034365455451983914571405062459535687617841302966938233065296973978472553109061974458935966754832788411876301179210585984208608247433383774246743661884093657109502619626436726032508763685599880808525861655167503719155953736308920858354069083437923495143680174206534169208623366776314544036377265501358254923029291010047210371394197963442022610746743020719292018028518885149189744832788117626194748311114409968846879212425054195323473068436359069318372735069308398135560733890706617536127579272964863500568572120716434126233695562326533941909353</span>
</span></span><span style=display:flex><span>c2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>14550589053226237723784378782911157204367764723813789158271625147472004207734354619642445255036997940341703539883653916130592718879734436263217819317202435434496341973502556894834798718992952369685841347018901038478081710519253844078907000973324354805502890255414196801758171762906898874914776720897920729518384393581853690034053515213192846817920534901501370942556249012415259244063185938984570137371682805276444650716010228924732495062415330875872004691866847132147232457398743319930259327973290858489741376000333603734294893832124907092640953321640151851853501528390729805151850605432707293088635480863375398001441</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>assert</span> c2 <span style=color:#f92672>&lt;</span> n
</span></span><span style=display:flex><span><span style=color:#66d9ef>assert</span> c1 <span style=color:#f92672>&lt;</span> n
</span></span><span style=display:flex><span><span style=color:#66d9ef>assert</span> c1 <span style=color:#f92672>&gt;</span> c2
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> (c1 <span style=color:#f92672>-</span> c2) <span style=color:#f92672>/</span> (hash1 <span style=color:#f92672>-</span> hash2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>a <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>b <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>*</span>(hash1 <span style=color:#f92672>+</span> hash2)
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> (hash1<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> hash1<span style=color:#f92672>*</span>hash2 <span style=color:#f92672>+</span> hash2<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span>) <span style=color:#f92672>-</span> res
</span></span><span style=display:flex><span><span style=color:#66d9ef>assert</span> b<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>4</span><span style=color:#f92672>*</span>a<span style=color:#f92672>*</span>c <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>det <span style=color:#f92672>=</span> gmpy2<span style=color:#f92672>.</span>iroot(b<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>4</span><span style=color:#f92672>*</span>a<span style=color:#f92672>*</span>c, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>#Result of the above operation</span>
</span></span><span style=display:flex><span>det <span style=color:#f92672>=</span> <span style=color:#ae81ff>895117860555194221639962847152553327251877885494596369020458400464169641215830527612022789636620223733091925404109820014339798528983673228478908782900199621057014409705139235003835944181120537080102658020544028036693589036615231884111568905196654</span>L
</span></span><span style=display:flex><span>sol1 <span style=color:#f92672>=</span> (det <span style=color:#f92672>-</span> b)<span style=color:#f92672>/</span>(<span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>a)
</span></span><span style=display:flex><span>print long_to_bytes(sol1)
</span></span></code></pre></div><p><strong>Flag</strong>: N1CTF{f7efbf4e5f5ef78ca1fb9c8f5eb02635}</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ashutosh1206.github.io/tags/rsa/>RSA</a></li><li><a href=https://ashutosh1206.github.io/tags/numbertheory/>NumberTheory</a></li><li><a href=https://ashutosh1206.github.io/tags/franklinreiter/>FranklinReiter</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://ashutosh1206.github.io/>Ashutosh Ahelleya</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>