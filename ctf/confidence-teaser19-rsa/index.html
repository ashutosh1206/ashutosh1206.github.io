<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>RSA - Teaser CONFidence CTF | Ash&#39;s blog</title>
<meta name="keywords" content="RSA, Coppersmith">
<meta name="description" content="tl;dr Coppersmith&rsquo;s Attack to recover RSA primes
Challenge Points: 99
Challenge Description:
You can&rsquo;t break my public key if you don&rsquo;t know it, amirite?
The challenge is based on RSA and we are given the following script:
def bytes_to_long(data): return int(data.encode(&#34;hex&#34;),16) def rsa(msg,e,n): return pow(bytes_to_long(msg),e,n) flag = open(&#39;flag.txt&#39;,&#39;r&#39;).read() tmp = randint(2**1023, 2**1024) e = 65537 p = next_prime(0xDEAD*tmp&#43;randint(2, 2**500)) q = next_prime(0xBEEF*tmp&#43;randint(2, 2**500)) N = p*q print(&#39;msg1 = &#39;&#43;str(rsa(&#34;You can&#39;t factor the modulus&#34;,e,N))) print(&#39;msg2 = &#39;&#43;str(rsa(&#34;If you don&#39;t know the modulus!">
<meta name="author" content="Ashutosh Ahelleya">
<link rel="canonical" href="https://ashutosh1206.github.io/ctf/confidence-teaser19-rsa/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css" integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://ashutosh1206.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ashutosh1206.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ashutosh1206.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://ashutosh1206.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://ashutosh1206.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
<meta property="og:title" content="RSA - Teaser CONFidence CTF" />
<meta property="og:description" content="tl;dr Coppersmith&rsquo;s Attack to recover RSA primes
Challenge Points: 99
Challenge Description:
You can&rsquo;t break my public key if you don&rsquo;t know it, amirite?
The challenge is based on RSA and we are given the following script:
def bytes_to_long(data): return int(data.encode(&#34;hex&#34;),16) def rsa(msg,e,n): return pow(bytes_to_long(msg),e,n) flag = open(&#39;flag.txt&#39;,&#39;r&#39;).read() tmp = randint(2**1023, 2**1024) e = 65537 p = next_prime(0xDEAD*tmp&#43;randint(2, 2**500)) q = next_prime(0xBEEF*tmp&#43;randint(2, 2**500)) N = p*q print(&#39;msg1 = &#39;&#43;str(rsa(&#34;You can&#39;t factor the modulus&#34;,e,N))) print(&#39;msg2 = &#39;&#43;str(rsa(&#34;If you don&#39;t know the modulus!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ashutosh1206.github.io/ctf/confidence-teaser19-rsa/" /><meta property="article:section" content="ctf" />
<meta property="article:published_time" content="2019-03-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-03-18T00:00:00+00:00" /><meta property="og:site_name" content="Ash&#39;s blog" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="RSA - Teaser CONFidence CTF"/>
<meta name="twitter:description" content="tl;dr Coppersmith&rsquo;s Attack to recover RSA primes
Challenge Points: 99
Challenge Description:
You can&rsquo;t break my public key if you don&rsquo;t know it, amirite?
The challenge is based on RSA and we are given the following script:
def bytes_to_long(data): return int(data.encode(&#34;hex&#34;),16) def rsa(msg,e,n): return pow(bytes_to_long(msg),e,n) flag = open(&#39;flag.txt&#39;,&#39;r&#39;).read() tmp = randint(2**1023, 2**1024) e = 65537 p = next_prime(0xDEAD*tmp&#43;randint(2, 2**500)) q = next_prime(0xBEEF*tmp&#43;randint(2, 2**500)) N = p*q print(&#39;msg1 = &#39;&#43;str(rsa(&#34;You can&#39;t factor the modulus&#34;,e,N))) print(&#39;msg2 = &#39;&#43;str(rsa(&#34;If you don&#39;t know the modulus!"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Ctfs",
      "item": "https://ashutosh1206.github.io/ctf/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "RSA - Teaser CONFidence CTF",
      "item": "https://ashutosh1206.github.io/ctf/confidence-teaser19-rsa/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "RSA - Teaser CONFidence CTF",
  "name": "RSA - Teaser CONFidence CTF",
  "description": "tl;dr Coppersmith\u0026rsquo;s Attack to recover RSA primes\nChallenge Points: 99\nChallenge Description:\nYou can\u0026rsquo;t break my public key if you don\u0026rsquo;t know it, amirite?\nThe challenge is based on RSA and we are given the following script:\ndef bytes_to_long(data): return int(data.encode(\u0026#34;hex\u0026#34;),16) def rsa(msg,e,n): return pow(bytes_to_long(msg),e,n) flag = open(\u0026#39;flag.txt\u0026#39;,\u0026#39;r\u0026#39;).read() tmp = randint(2**1023, 2**1024) e = 65537 p = next_prime(0xDEAD*tmp+randint(2, 2**500)) q = next_prime(0xBEEF*tmp+randint(2, 2**500)) N = p*q print(\u0026#39;msg1 = \u0026#39;+str(rsa(\u0026#34;You can\u0026#39;t factor the modulus\u0026#34;,e,N))) print(\u0026#39;msg2 = \u0026#39;+str(rsa(\u0026#34;If you don\u0026#39;t know the modulus!",
  "keywords": [
    "RSA", "Coppersmith"
  ],
  "articleBody": "tl;dr Coppersmith’s Attack to recover RSA primes\nChallenge Points: 99\nChallenge Description:\nYou can’t break my public key if you don’t know it, amirite?\nThe challenge is based on RSA and we are given the following script:\ndef bytes_to_long(data): return int(data.encode(\"hex\"),16) def rsa(msg,e,n): return pow(bytes_to_long(msg),e,n) flag = open('flag.txt','r').read() tmp = randint(2**1023, 2**1024) e = 65537 p = next_prime(0xDEAD*tmp+randint(2, 2**500)) q = next_prime(0xBEEF*tmp+randint(2, 2**500)) N = p*q print('msg1 = '+str(rsa(\"You can't factor the modulus\",e,N))) print('msg2 = '+str(rsa(\"If you don't know the modulus!\",e,N))) print('flag = '+str(rsa(flag,e,N))) We are given ciphertext of two plaintext messages \\(m_1\\) “You can’t factor the modulus” and \\(m_2\\) “If you don’t know the modulus!”, and encrypted text of the flag in output.txt:\nmsg1 = 4249729541274832324831915101850978041491970958978013333892918723306168770472089196478720527554982764987079625218029445015042835412969986610407794962546486526768377464483162272541733624521350257458334912357961557141551376502679112069746250223130120067678503609054343306910481618502449487751467838568736395758064426403381068760701434585433915614901796040740316824283643177505677105619002929103619338876322183416750542848507631412106633630984867562243228659040403724671325236096319784525457674398019860558530212905126133378508676777200538275088387251038714220361173376355185449239483472545370043145325106307606431828449482078191 msg2 = 13075855845498384344820257559893309320125843093107442572680776872299102248743866420640323500087788163238819301260173322187978140866718036292385520509724506487692001245730298675731681509412177547061396861961413760298064385526657135656283464759479388590822600747903100354135682624356454872283852822117199641700847558605700370117557855396952083088645477966782338316017387406733063346986224014837246404581562813312855644424128648363175792786282857154624788625411070173092512834181678732914231669616670515512774709315620233482515821178277673737845032672993814500177126048019814877397547310166915188341668439101769932492677363463422 flag = 1325070956009103489249194637347510588506729608784127511926628895543304940415297099207601498626181915901848862854995077315475674257593360012633818395699000501896896712855638114932274873636706679536094148084825113213348693669110684534612150434985589138003619494080556587882502882245480530148296233019306164832959924719530089539412878605051284492900919153291539285764067215954480046474237129247005910958854570936626494664674014970792183182621261776942952172643573955950074108555363333808330455648256916095619261620286120748266415219259665310637340092503523139379869446053982200858497231506892485419429178671743186148288407233657 Some observations:\nWe are not given the public modulus in this challenge. Factors of the modulus n are derived and there exists a relation between them Based on the above observations, one can say that the challenge can be solved in two steps:\nRecover the public modulus using the ciphertext-plaintext pairs Since there exists a relation between factors of n, recover factors based on this and decrypt the ciphertext of the flag. Recovering the modulus Let the ciphertext of message \\(m_1\\) be \\(c_1\\) and ciphertext of message \\(m_2\\) be \\(c_2\\). We can write:\n$$ m_1^e \\equiv c_1\\mod n $$ $$ m_2^e \\equiv c_2\\mod n $$\nThis implies: $$ m_1^e - c_1 = k_1*n $$ $$ m_2^e - c_2 = k_2*n $$ where \\( k_1, k_2 \\in \\mathbb{Z}^+ \\)\nHence, $$ GCD(m_1^e - c_1, m_2^e - c_2) = GCD(k_1*n, k_2*n) = k’*n $$\nWith the above equation we can recover a multiple of n, where k' is a small number and can be detected simply by brute force. We wrote the following code using sagemath (python took longer time on our laptops to calculate since the messages are quite large) to recover n\nfrom Crypto.Util.number import * from sage.all import * c1 = 4249729541274832324831915101850978041491970958978013333892918723306168770472089196478720527554982764987079625218029445015042835412969986610407794962546486526768377464483162272541733624521350257458334912357961557141551376502679112069746250223130120067678503609054343306910481618502449487751467838568736395758064426403381068760701434585433915614901796040740316824283643177505677105619002929103619338876322183416750542848507631412106633630984867562243228659040403724671325236096319784525457674398019860558530212905126133378508676777200538275088387251038714220361173376355185449239483472545370043145325106307606431828449482078191 c2 = 13075855845498384344820257559893309320125843093107442572680776872299102248743866420640323500087788163238819301260173322187978140866718036292385520509724506487692001245730298675731681509412177547061396861961413760298064385526657135656283464759479388590822600747903100354135682624356454872283852822117199641700847558605700370117557855396952083088645477966782338316017387406733063346986224014837246404581562813312855644424128648363175792786282857154624788625411070173092512834181678732914231669616670515512774709315620233482515821178277673737845032672993814500177126048019814877397547310166915188341668439101769932492677363463422 flag = 1325070956009103489249194637347510588506729608784127511926628895543304940415297099207601498626181915901848862854995077315475674257593360012633818395699000501896896712855638114932274873636706679536094148084825113213348693669110684534612150434985589138003619494080556587882502882245480530148296233019306164832959924719530089539412878605051284492900919153291539285764067215954480046474237129247005910958854570936626494664674014970792183182621261776942952172643573955950074108555363333808330455648256916095619261620286120748266415219259665310637340092503523139379869446053982200858497231506892485419429178671743186148288407233657 m1 = bytes_to_long(\"You can't factor the modulus\") m2 = bytes_to_long(\"If you don't know the modulus!\") e = 65537 N = GCD(pow(m1, e) - c1, pow(m2, e) - c2) print N Coincidentally, GCD gave us the exact value of n. We can verify this by simply encrypting the given messages \\(m_1\\) and \\(m_2\\) with our recovered modulus value and given exponent \\(e\\), and check if they match with their corresponding given ciphertexts \\(c_1\\) and \\(c_2\\).\nRunning the above code gives the value of n as:\nN = 34825223743402829383680359547814183240817664070909938698674658390374124787235739502688056639022131897715513587903467527066065545399622834534513631867145432553730850980331789931667370903396032758515681278057031496814054828419443822343986117760958186984521716807347123949922837482460532728350223473430713058522361175980521908817215812291272284241848086260180382693014713901303747444753828636575351349026883294939561001468099252543181336195746032718177937417431101756313823635150129601855358558635996348271242920308406268552606733676301725088348399264293936151662467456410825402303921583389167882090767423931762347825907802328053 Now that we have value of \\(N\\), let’s move to the second and final step in solving the challenge!\nFactoring N using Coppersmith’s Theorem This step is almost the same as part-3 of Old-School challenge from Meepwn CTF 2018: https://github.com/p4-team/ctf/tree/master/2018-07-13-meepwn-ctf/crypto_old_school#part3\nWe are given the following relation between p and q:\ntmp = randint(2**1023, 2**1024) e = 65537 p = next_prime(0xDEAD*tmp+randint(2, 2**500)) q = next_prime(0xBEEF*tmp+randint(2, 2**500)) N = p*q We can approximate the value of tmp and then try to recover p and q based on the approximation:\n\\(\\Delta_1 = randint(2^{500}) \\)\n\\(\\Delta_2 = randint(2^{500}) \\)\n\\(tmp = randint(2^{1023}, 2^{2014}) \\)\n\\(N = (0xdead*tmp + \\Delta_1) * (0xbeef*tmp + \\Delta_2) \\)\n\\(N = (0xdead*0xbeef)*tmp^2 + (0xdead*\\Delta_2)*tmp + (0xbeef*\\Delta_1)*tmp + (\\Delta_1*\\Delta_2) \\)\n\\(N = (0xdead*0xbeef)*tmp^2 + (0xdead*\\Delta_2 + 0xbeef*\\Delta_1)*tmp + (\\Delta_1*\\Delta_2) \\)\n\\(\\implies (0xdead*0xbeef)*tmp^2 + (0xdead*\\Delta_2 + 0xbeef*\\Delta_1)*tmp + (\\Delta_1*\\Delta_2 - N) == 0 \\)\nWe can take the approximate value of tmp as: $$ tmp\\_approx = \\sqrt{\\frac{N}{0xdead*0xbeef}}$$\nWith the above approximation, we can calculate upper bound of one of the factors of N, let’s say q_approx as:\n$$ q\\_approx = 0xbeef*tmp\\_approx - 2^{500} $$\nNote: We still don’t have a strong mathematical explanation as to why \\(q\\_approx = 0xbeef*tmp\\_approx - 2^{500}\\) and not \\(q\\_approx = 0xbeef*tmp\\_approx + 2^{500}\\), we deduced the formula based on the writeup for Meepwn CTF challenge mentioned earlier.\nI discussed it with Shalom (challenge author) about this, but the reason is still not clear; here is an excerpt of the conversation from IRC:\nSo if you have a mathematical explanation, feel free to comment or reach me out on Twitter! I would love it!\nNow that we have q_approx, we can use Coppersmith’s Theorem to recover the actual value of q. I wrote the following script for this:\nhidden = 500 tmp = isqrt((N)/(0xdead * 0xbeef)) print \"tmp: \", tmp q_approx = 0xbeef*tmp - 2**500 print q_approx F. = PolynomialRing(Zmod(N), implementation='NTL') f = x - q_approx roots = f.small_roots(X=2**hidden, beta=0.1) for delta in roots: print('delta', delta) print('q_approx - delta', q_approx-delta) q = q_approx-delta p = int(N)/int(q) d = inverse_mod(65537, (p-1)*(q-1)) print(\"d\", d) decrypted = hex(int(pow(c,d,N))) print('flag =', decrypted[2:-1].decode(\"hex\")) Let us see how the above script works: We know that q_approx is basically the upper bound for possible value of q. To get the actual value we need to subtract a value x from q_approx such that the result becomes a factor of modulus N. Hence we wrote the script implementing the above idea!\nIf you want to learn about Coppersmith’s Attack in detail you can refer to this article from Crypton library: https://github.com/ashutosh1206/Crypton/tree/master/RSA-encryption/Attack-Coppersmith\nThe full script (python/sage):\nfrom Crypto.Util.number import * from sage.all import * c1 = 4249729541274832324831915101850978041491970958978013333892918723306168770472089196478720527554982764987079625218029445015042835412969986610407794962546486526768377464483162272541733624521350257458334912357961557141551376502679112069746250223130120067678503609054343306910481618502449487751467838568736395758064426403381068760701434585433915614901796040740316824283643177505677105619002929103619338876322183416750542848507631412106633630984867562243228659040403724671325236096319784525457674398019860558530212905126133378508676777200538275088387251038714220361173376355185449239483472545370043145325106307606431828449482078191 c2 = 13075855845498384344820257559893309320125843093107442572680776872299102248743866420640323500087788163238819301260173322187978140866718036292385520509724506487692001245730298675731681509412177547061396861961413760298064385526657135656283464759479388590822600747903100354135682624356454872283852822117199641700847558605700370117557855396952083088645477966782338316017387406733063346986224014837246404581562813312855644424128648363175792786282857154624788625411070173092512834181678732914231669616670515512774709315620233482515821178277673737845032672993814500177126048019814877397547310166915188341668439101769932492677363463422 flag = 1325070956009103489249194637347510588506729608784127511926628895543304940415297099207601498626181915901848862854995077315475674257593360012633818395699000501896896712855638114932274873636706679536094148084825113213348693669110684534612150434985589138003619494080556587882502882245480530148296233019306164832959924719530089539412878605051284492900919153291539285764067215954480046474237129247005910958854570936626494664674014970792183182621261776942952172643573955950074108555363333808330455648256916095619261620286120748266415219259665310637340092503523139379869446053982200858497231506892485419429178671743186148288407233657 m1 = bytes_to_long(\"You can't factor the modulus\") m2 = bytes_to_long(\"If you don't know the modulus!\") e = 65537 N = 34825223743402829383680359547814183240817664070909938698674658390374124787235739502688056639022131897715513587903467527066065545399622834534513631867145432553730850980331789931667370903396032758515681278057031496814054828419443822343986117760958186984521716807347123949922837482460532728350223473430713058522361175980521908817215812291272284241848086260180382693014713901303747444753828636575351349026883294939561001468099252543181336195746032718177937417431101756313823635150129601855358558635996348271242920308406268552606733676301725088348399264293936151662467456410825402303921583389167882090767423931762347825907802328053 c = flag hidden = 500 tmp = isqrt((N)/(0xdead * 0xbeef)) print \"tmp: \", tmp q_approx = 0xbeef*tmp - 2**500 print q_approx F. = PolynomialRing(Zmod(N), implementation='NTL') f = x - q_approx roots = f.small_roots(X=2**hidden, beta=0.1) for delta in roots: print('delta', delta) print('q_approx - delta', q_approx-delta) q = q_approx-delta p = int(N)/int(q) d = inverse_mod(65537, (p-1)*(q-1)) print(\"d\", d) decrypted = hex(int(pow(c,d,N))) print('flag =', decrypted[2:-1].decode(\"hex\")) Running the above script gives us the flag: p4{S3cur1ty_th0ru9h_0b5cur1ty_4t_i7s_fin3s7}\n",
  "wordCount" : "959",
  "inLanguage": "en",
  "datePublished": "2019-03-18T00:00:00Z",
  "dateModified": "2019-03-18T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Ashutosh Ahelleya"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ashutosh1206.github.io/ctf/confidence-teaser19-rsa/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ash's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ashutosh1206.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ashutosh1206.github.io/" accesskey="h" title="Home (Alt + H)">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ashutosh1206.github.io/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://ashutosh1206.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://ashutosh1206.github.io/archive/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://ashutosh1206.github.io/ctf/" title="CTF">
                    <span>CTF</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      RSA - Teaser CONFidence CTF
    </h1>
    <div class="post-meta"><span title='2019-03-18 00:00:00 +0000 UTC'>March 18, 2019</span>&nbsp;·&nbsp;Ashutosh Ahelleya

</div>
  </header> 
  <div class="post-content"><p>tl;dr Coppersmith&rsquo;s Attack to recover RSA primes</p>
<p><strong>Challenge Points</strong>: 99<br>
<strong>Challenge Description</strong>:</p>
<blockquote>
<p>You can&rsquo;t break my public key if you don&rsquo;t know it, amirite?</p>
</blockquote>
<p>The challenge is based on RSA and we are given the following script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">bytes_to_long</span>(data):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> int(data<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#34;hex&#34;</span>),<span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rsa</span>(msg,e,n):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pow(bytes_to_long(msg),e,n)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;flag.txt&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>)<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>tmp <span style="color:#f92672">=</span> randint(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">1023</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> next_prime(<span style="color:#ae81ff">0xDEAD</span><span style="color:#f92672">*</span>tmp<span style="color:#f92672">+</span>randint(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">500</span>))
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> next_prime(<span style="color:#ae81ff">0xBEEF</span><span style="color:#f92672">*</span>tmp<span style="color:#f92672">+</span>randint(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">500</span>))
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span>  p<span style="color:#f92672">*</span>q
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;msg1 = &#39;</span><span style="color:#f92672">+</span>str(rsa(<span style="color:#e6db74">&#34;You can&#39;t factor the modulus&#34;</span>,e,N)))
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;msg2 = &#39;</span><span style="color:#f92672">+</span>str(rsa(<span style="color:#e6db74">&#34;If you don&#39;t know the modulus!&#34;</span>,e,N)))
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;flag = &#39;</span><span style="color:#f92672">+</span>str(rsa(flag,e,N)))
</span></span></code></pre></div><p>We are given ciphertext of two plaintext messages \(m_1\) “You can’t factor the modulus” and \(m_2\) “If you don’t know the modulus!”, and encrypted text of the flag in <code>output.txt</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>msg1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">4249729541274832324831915101850978041491970958978013333892918723306168770472089196478720527554982764987079625218029445015042835412969986610407794962546486526768377464483162272541733624521350257458334912357961557141551376502679112069746250223130120067678503609054343306910481618502449487751467838568736395758064426403381068760701434585433915614901796040740316824283643177505677105619002929103619338876322183416750542848507631412106633630984867562243228659040403724671325236096319784525457674398019860558530212905126133378508676777200538275088387251038714220361173376355185449239483472545370043145325106307606431828449482078191</span>
</span></span><span style="display:flex;"><span>msg2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">13075855845498384344820257559893309320125843093107442572680776872299102248743866420640323500087788163238819301260173322187978140866718036292385520509724506487692001245730298675731681509412177547061396861961413760298064385526657135656283464759479388590822600747903100354135682624356454872283852822117199641700847558605700370117557855396952083088645477966782338316017387406733063346986224014837246404581562813312855644424128648363175792786282857154624788625411070173092512834181678732914231669616670515512774709315620233482515821178277673737845032672993814500177126048019814877397547310166915188341668439101769932492677363463422</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#ae81ff">1325070956009103489249194637347510588506729608784127511926628895543304940415297099207601498626181915901848862854995077315475674257593360012633818395699000501896896712855638114932274873636706679536094148084825113213348693669110684534612150434985589138003619494080556587882502882245480530148296233019306164832959924719530089539412878605051284492900919153291539285764067215954480046474237129247005910958854570936626494664674014970792183182621261776942952172643573955950074108555363333808330455648256916095619261620286120748266415219259665310637340092503523139379869446053982200858497231506892485419429178671743186148288407233657</span>
</span></span></code></pre></div><p>Some observations:</p>
<ol>
<li>We are not given the public modulus in this challenge.</li>
<li>Factors of the modulus <code>n</code> are derived and there exists a relation between them</li>
</ol>
<p>Based on the above observations, one can say that the challenge can be solved in two steps:</p>
<ol>
<li>Recover the public modulus using the ciphertext-plaintext pairs</li>
<li>Since there exists a relation between factors of <code>n</code>, recover factors based on this and decrypt the ciphertext of the flag.</li>
</ol>
<h2 id="recovering-the-modulus">Recovering the modulus<a hidden class="anchor" aria-hidden="true" href="#recovering-the-modulus">#</a></h2>
<p>Let the ciphertext of message \(m_1\) be \(c_1\) and ciphertext of message \(m_2\) be \(c_2\). We can write:<br>
$$ m_1^e \equiv c_1\mod n $$
$$ m_2^e \equiv c_2\mod n $$</p>
<p>This implies:
$$ m_1^e - c_1 = k_1*n $$
$$ m_2^e - c_2 = k_2*n $$
where \( k_1, k_2 \in \mathbb{Z}^+ \)</p>
<p>Hence,
$$ GCD(m_1^e - c_1, m_2^e - c_2) = GCD(k_1*n, k_2*n) = k&rsquo;*n $$</p>
<p>With the above equation we can recover a multiple of <code>n</code>, where <code>k'</code> is a small number and can be detected
simply by brute force. We wrote the following code using sagemath (python took longer time on our laptops
to calculate since the messages are quite large) to recover <code>n</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>c1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">4249729541274832324831915101850978041491970958978013333892918723306168770472089196478720527554982764987079625218029445015042835412969986610407794962546486526768377464483162272541733624521350257458334912357961557141551376502679112069746250223130120067678503609054343306910481618502449487751467838568736395758064426403381068760701434585433915614901796040740316824283643177505677105619002929103619338876322183416750542848507631412106633630984867562243228659040403724671325236096319784525457674398019860558530212905126133378508676777200538275088387251038714220361173376355185449239483472545370043145325106307606431828449482078191</span>
</span></span><span style="display:flex;"><span>c2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">13075855845498384344820257559893309320125843093107442572680776872299102248743866420640323500087788163238819301260173322187978140866718036292385520509724506487692001245730298675731681509412177547061396861961413760298064385526657135656283464759479388590822600747903100354135682624356454872283852822117199641700847558605700370117557855396952083088645477966782338316017387406733063346986224014837246404581562813312855644424128648363175792786282857154624788625411070173092512834181678732914231669616670515512774709315620233482515821178277673737845032672993814500177126048019814877397547310166915188341668439101769932492677363463422</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#ae81ff">1325070956009103489249194637347510588506729608784127511926628895543304940415297099207601498626181915901848862854995077315475674257593360012633818395699000501896896712855638114932274873636706679536094148084825113213348693669110684534612150434985589138003619494080556587882502882245480530148296233019306164832959924719530089539412878605051284492900919153291539285764067215954480046474237129247005910958854570936626494664674014970792183182621261776942952172643573955950074108555363333808330455648256916095619261620286120748266415219259665310637340092503523139379869446053982200858497231506892485419429178671743186148288407233657</span>
</span></span><span style="display:flex;"><span>m1 <span style="color:#f92672">=</span> bytes_to_long(<span style="color:#e6db74">&#34;You can&#39;t factor the modulus&#34;</span>)
</span></span><span style="display:flex;"><span>m2 <span style="color:#f92672">=</span> bytes_to_long(<span style="color:#e6db74">&#34;If you don&#39;t know the modulus!&#34;</span>)
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> GCD(pow(m1, e) <span style="color:#f92672">-</span> c1, pow(m2, e) <span style="color:#f92672">-</span> c2)
</span></span><span style="display:flex;"><span>print N
</span></span></code></pre></div><p>Coincidentally, GCD gave us the exact value of <code>n</code>. We can verify this by simply encrypting the given messages \(m_1\) and \(m_2\) with our recovered modulus value and given exponent \(e\), and check if they match with their corresponding given ciphertexts \(c_1\) and \(c_2\).</p>
<p>Running the above code gives the value of <code>n</code> as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">34825223743402829383680359547814183240817664070909938698674658390374124787235739502688056639022131897715513587903467527066065545399622834534513631867145432553730850980331789931667370903396032758515681278057031496814054828419443822343986117760958186984521716807347123949922837482460532728350223473430713058522361175980521908817215812291272284241848086260180382693014713901303747444753828636575351349026883294939561001468099252543181336195746032718177937417431101756313823635150129601855358558635996348271242920308406268552606733676301725088348399264293936151662467456410825402303921583389167882090767423931762347825907802328053</span>
</span></span></code></pre></div><p>Now that we have value of \(N\), let’s move to the second and final step in solving the challenge!</p>
<h2 id="factoring-n-using-coppersmiths-theorem">Factoring N using Coppersmith&rsquo;s Theorem<a hidden class="anchor" aria-hidden="true" href="#factoring-n-using-coppersmiths-theorem">#</a></h2>
<p>This step is almost the same as part-3 of Old-School challenge from Meepwn CTF 2018:
<a href="https://github.com/p4-team/ctf/tree/master/2018-07-13-meepwn-ctf/crypto_old_school#part3">https://github.com/p4-team/ctf/tree/master/2018-07-13-meepwn-ctf/crypto_old_school#part3</a></p>
<p>We are given the following relation between <code>p</code> and <code>q</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>tmp <span style="color:#f92672">=</span> randint(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">1023</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> next_prime(<span style="color:#ae81ff">0xDEAD</span><span style="color:#f92672">*</span>tmp<span style="color:#f92672">+</span>randint(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">500</span>))
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> next_prime(<span style="color:#ae81ff">0xBEEF</span><span style="color:#f92672">*</span>tmp<span style="color:#f92672">+</span>randint(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">500</span>))
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span>  p<span style="color:#f92672">*</span>q
</span></span></code></pre></div><p>We can approximate the value of <code>tmp</code> and then try to recover <code>p</code> and <code>q</code> based on the approximation:<br>
\(\Delta_1 = randint(2^{500}) \)</p>
<p>\(\Delta_2 = randint(2^{500}) \)</p>
<p>\(tmp = randint(2^{1023}, 2^{2014}) \)</p>
<p>\(N = (0xdead*tmp + \Delta_1) * (0xbeef*tmp + \Delta_2) \)</p>
<p>\(N = (0xdead*0xbeef)*tmp^2 + (0xdead*\Delta_2)*tmp + (0xbeef*\Delta_1)*tmp + (\Delta_1*\Delta_2) \)</p>
<p>\(N = (0xdead*0xbeef)*tmp^2 + (0xdead*\Delta_2 + 0xbeef*\Delta_1)*tmp + (\Delta_1*\Delta_2) \)</p>
<p>\(\implies (0xdead*0xbeef)*tmp^2 + (0xdead*\Delta_2 + 0xbeef*\Delta_1)*tmp + (\Delta_1*\Delta_2 - N) == 0 \)</p>
<p>We can take the approximate value of <code>tmp</code> as:
$$ tmp\_approx = \sqrt{\frac{N}{0xdead*0xbeef}}$$</p>
<p>With the above approximation, we can calculate upper bound of one of
the factors of N, let’s say q_approx as:</p>
<p>$$ q\_approx = 0xbeef*tmp\_approx - 2^{500} $$</p>
<blockquote>
<p><strong>Note</strong>: We still don’t have a strong mathematical explanation as to why \(q\_approx = 0xbeef*tmp\_approx - 2^{500}\) and not \(q\_approx = 0xbeef*tmp\_approx + 2^{500}\), we
deduced the formula based on the writeup for Meepwn CTF challenge mentioned earlier.</p>
</blockquote>
<p>I discussed it with Shalom (challenge author) about this, but the reason is still not clear; here is an excerpt of the conversation from IRC:</p>
<p><img loading="lazy" src="/confidence-teaser-rsa-1.png" alt="picture"  />
<br>
<img loading="lazy" src="/confidence-teaser-rsa-2.png" alt="picture"  />
</p>
<p>So if you have a mathematical explanation, feel free to comment or <a href="https://twitter.com/ashutosha_">reach me out on Twitter</a>! I would love it!</p>
<p>Now that we have q_approx, we can use Coppersmith’s Theorem to recover the actual value of q. I wrote the following script for this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>hidden <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>
</span></span><span style="display:flex;"><span>tmp <span style="color:#f92672">=</span> isqrt((N)<span style="color:#f92672">/</span>(<span style="color:#ae81ff">0xdead</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0xbeef</span>))
</span></span><span style="display:flex;"><span>print <span style="color:#e6db74">&#34;tmp: &#34;</span>, tmp
</span></span><span style="display:flex;"><span>q_approx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xbeef</span><span style="color:#f92672">*</span>tmp <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">500</span>
</span></span><span style="display:flex;"><span>print q_approx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>F<span style="color:#f92672">.</span> <span style="color:#f92672">=</span> PolynomialRing(Zmod(N), implementation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;NTL&#39;</span>)
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> q_approx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>roots <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>small_roots(X<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>hidden, beta<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> delta <span style="color:#f92672">in</span> roots:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;delta&#39;</span>, delta)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;q_approx - delta&#39;</span>, q_approx<span style="color:#f92672">-</span>delta)
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> q_approx<span style="color:#f92672">-</span>delta
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> int(N)<span style="color:#f92672">/</span>int(q)
</span></span><span style="display:flex;"><span>    d <span style="color:#f92672">=</span> inverse_mod(<span style="color:#ae81ff">65537</span>, (p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(q<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;d&#34;</span>, d)
</span></span><span style="display:flex;"><span>    decrypted <span style="color:#f92672">=</span> hex(int(pow(c,d,N)))
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;flag =&#39;</span>, decrypted[<span style="color:#ae81ff">2</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;hex&#34;</span>))
</span></span></code></pre></div><p>Let us see how the above script works:
We know that <code>q_approx</code> is basically the upper bound for possible value of <code>q</code>. To get the actual value we need to subtract a value <code>x</code> from <code>q_approx</code> such that the result becomes a factor of modulus <code>N</code>.
Hence we wrote the script implementing the above idea!</p>
<p>If you want to learn about Coppersmith’s Attack in detail you can refer to this article from Crypton library:
<a href="https://github.com/ashutosh1206/Crypton/tree/master/RSA-encryption/Attack-Coppersmith">https://github.com/ashutosh1206/Crypton/tree/master/RSA-encryption/Attack-Coppersmith</a></p>
<p>The full script (python/sage):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>c1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">4249729541274832324831915101850978041491970958978013333892918723306168770472089196478720527554982764987079625218029445015042835412969986610407794962546486526768377464483162272541733624521350257458334912357961557141551376502679112069746250223130120067678503609054343306910481618502449487751467838568736395758064426403381068760701434585433915614901796040740316824283643177505677105619002929103619338876322183416750542848507631412106633630984867562243228659040403724671325236096319784525457674398019860558530212905126133378508676777200538275088387251038714220361173376355185449239483472545370043145325106307606431828449482078191</span>
</span></span><span style="display:flex;"><span>c2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">13075855845498384344820257559893309320125843093107442572680776872299102248743866420640323500087788163238819301260173322187978140866718036292385520509724506487692001245730298675731681509412177547061396861961413760298064385526657135656283464759479388590822600747903100354135682624356454872283852822117199641700847558605700370117557855396952083088645477966782338316017387406733063346986224014837246404581562813312855644424128648363175792786282857154624788625411070173092512834181678732914231669616670515512774709315620233482515821178277673737845032672993814500177126048019814877397547310166915188341668439101769932492677363463422</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#ae81ff">1325070956009103489249194637347510588506729608784127511926628895543304940415297099207601498626181915901848862854995077315475674257593360012633818395699000501896896712855638114932274873636706679536094148084825113213348693669110684534612150434985589138003619494080556587882502882245480530148296233019306164832959924719530089539412878605051284492900919153291539285764067215954480046474237129247005910958854570936626494664674014970792183182621261776942952172643573955950074108555363333808330455648256916095619261620286120748266415219259665310637340092503523139379869446053982200858497231506892485419429178671743186148288407233657</span>
</span></span><span style="display:flex;"><span>m1 <span style="color:#f92672">=</span> bytes_to_long(<span style="color:#e6db74">&#34;You can&#39;t factor the modulus&#34;</span>)
</span></span><span style="display:flex;"><span>m2 <span style="color:#f92672">=</span> bytes_to_long(<span style="color:#e6db74">&#34;If you don&#39;t know the modulus!&#34;</span>)
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">=</span> <span style="color:#ae81ff">34825223743402829383680359547814183240817664070909938698674658390374124787235739502688056639022131897715513587903467527066065545399622834534513631867145432553730850980331789931667370903396032758515681278057031496814054828419443822343986117760958186984521716807347123949922837482460532728350223473430713058522361175980521908817215812291272284241848086260180382693014713901303747444753828636575351349026883294939561001468099252543181336195746032718177937417431101756313823635150129601855358558635996348271242920308406268552606733676301725088348399264293936151662467456410825402303921583389167882090767423931762347825907802328053</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> flag
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>hidden <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>
</span></span><span style="display:flex;"><span>tmp <span style="color:#f92672">=</span> isqrt((N)<span style="color:#f92672">/</span>(<span style="color:#ae81ff">0xdead</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0xbeef</span>))
</span></span><span style="display:flex;"><span>print <span style="color:#e6db74">&#34;tmp: &#34;</span>, tmp
</span></span><span style="display:flex;"><span>q_approx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xbeef</span><span style="color:#f92672">*</span>tmp <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">500</span>
</span></span><span style="display:flex;"><span>print q_approx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>F<span style="color:#f92672">.</span> <span style="color:#f92672">=</span> PolynomialRing(Zmod(N), implementation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;NTL&#39;</span>)
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> q_approx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>roots <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>small_roots(X<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>hidden, beta<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> delta <span style="color:#f92672">in</span> roots:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;delta&#39;</span>, delta)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;q_approx - delta&#39;</span>, q_approx<span style="color:#f92672">-</span>delta)
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> q_approx<span style="color:#f92672">-</span>delta
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> int(N)<span style="color:#f92672">/</span>int(q)
</span></span><span style="display:flex;"><span>    d <span style="color:#f92672">=</span> inverse_mod(<span style="color:#ae81ff">65537</span>, (p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(q<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;d&#34;</span>, d)
</span></span><span style="display:flex;"><span>    decrypted <span style="color:#f92672">=</span> hex(int(pow(c,d,N)))
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;flag =&#39;</span>, decrypted[<span style="color:#ae81ff">2</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;hex&#34;</span>))
</span></span></code></pre></div><p>Running the above script gives us the flag: <strong>p4{S3cur1ty_th0ru9h_0b5cur1ty_4t_i7s_fin3s7}</strong></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://ashutosh1206.github.io/tags/rsa/">RSA</a></li>
      <li><a href="https://ashutosh1206.github.io/tags/coppersmith/">Coppersmith</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://ashutosh1206.github.io/">Ash&#39;s blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
